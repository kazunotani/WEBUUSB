<!DOCTYPE html>
<html>
<head>
  <title>WebUSB Echo</title>
</head>
<body>
  <h2>ğŸ”Œ WebUSB ho é€šä¿¡ãƒ†ã‚¹ãƒˆ</h2>
  <button id="connect">Arduinoã«æ¥ç¶š</button><br><br>

  <input id="input" type="text" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å…¥åŠ›">
  <button id="send">é€ä¿¡</button>
  <pre id="log"></pre>

  <script>
    let device;

    const log = (msg) => {
      document.getElementById("log").textContent += msg + "\n";
    };

document.getElementById("connect").onclick = async () => {
  try {
    device = await navigator.usb.requestDevice({
      filters: [{ vendorId: 0x2341 }]  // Arduinoã®VID
    });
    await device.open();
    await device.selectConfiguration(1);

    console.log("âœ… USB æ§‹æˆæƒ…å ±:");
    for (const iface of device.configuration.interfaces) {
      console.log("Interface Number:", iface.interfaceNumber);
      for (const alt of iface.alternates) {
        console.log("  Class:", alt.interfaceClass);
        for (const ep of alt.endpoints) {
          console.log(`    Endpoint: ${ep.endpointNumber}, Direction: ${ep.direction}`);
        }
      }
    }

    // ä¸€æ—¦ interface 2 ã‚’ä»®ã«é¸æŠã—ã¦ãŠãï¼ˆãƒ­ã‚°ã‚’è¦‹ã¦èª¿æ•´å¯èƒ½ï¼‰
    await device.claimInterface(2);
    console.log("âœ… ãƒ‡ãƒã‚¤ã‚¹ã«æ¥ç¶šã—ã¾ã—ãŸ");
  } catch (e) {
    console.error("âŒ æ¥ç¶šã‚¨ãƒ©ãƒ¼:", e);
  }
};

    document.getElementById("send").onclick = async () => {
      const text = document.getElementById("input").value + "\n";
      const encoder = new TextEncoder();
      const data = encoder.encode(text);
      try {
        await device.transferOut(3, data); // endpointç•ªå·ã¯3ã‹4ãŒå¤šã„
        log("é€ä¿¡: " + text.trim());
      } catch (e) {
        log("é€ä¿¡å¤±æ•—: " + e);
      }
    };
  </script>
</body>
</html>
