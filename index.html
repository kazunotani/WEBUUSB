<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
  <a href="#"id="click">Connect</a>
  <script src="serial.js"></script>
  <script>
     serial.requestPort = function() {
    const filters = [
     { 'vendorId': 0x2341, 'productId': 0x8037 }, // Arduino Micro
    ];
    return navigator.usb.requestDevice({ 'filters': filters }).then(
      device => new serial.Port(device)
    );
  }
  var port
  var connectButton = document.getElementById("click")
  var textDecoder = new TextDecoder();

  connectButton.addEventListener("click",function(){
    if(port){
      connectButton.textContent = "connect"
      port.disconnect()
      port = null
    }else{
      serial.requestPort().then(selectedPort =>{
        port = selectedPort
        port.connect(() => {
          console.log("conected!");
          connectButton.textContent = "disonnect"
          port.onReceive = data => {console.log(textDecoder.decode(data))}
          port.onReceiveError = error => {console.log("receive error:" + error)}
        });
      })
    }
  })

  </script>
</body>
</html>
