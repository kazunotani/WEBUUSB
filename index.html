<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>WebUSB LED Control</title>
</head>
<body>
  <h1>WebUSB LED Control</h1>
  <button id="connect">デバイス接続</button>
  <button id="ledOn" disabled>LED ON</button>
  <button id="ledOff" disabled>LED OFF</button>
  <pre id="log"></pre>

  <script>
    let device;
    const log = (msg) => {
      document.getElementById('log').textContent += msg + '\n';
    };

    document.getElementById("connect").onclick = async () => {
      try {
        device = await navigator.usb.requestDevice({
          filters: [{ vendorId: 0x2341 }] // ArduinoのVID
        });
        await device.open();
        await device.selectConfiguration(1);
        await device.claimInterface(2); // interfaceNumberは2（要調整）
        log("✅ 接続成功");
        document.getElementById("ledOn").disabled = false;
        document.getElementById("ledOff").disabled = false;
      } catch (e) {
        log("❌ 接続失敗: " + e.message);
      }
    };

    const sendCommand = async (cmd) => {
      const encoder = new TextEncoder();
      await device.transferOut(4, encoder.encode(cmd + '\n'));
    };

    document.getElementById("ledOn").onclick = () => sendCommand("ON");
    document.getElementById("ledOff").onclick = () => sendCommand("OFF");
  </script>
</body>
</html>
