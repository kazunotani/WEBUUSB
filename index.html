<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>WebUSB LED Control</title>
</head>
<body>
  <h1>WebUSB LED Control</h1>
  <button id="connect">„Éá„Éê„Ç§„ÇπÊé•Á∂ö</button>
  <button id="ledOn" disabled>LED ON</button>
  <button id="ledOff" disabled>LED OFF</button>
  <pre id="log"></pre>

  <script>
    let device;
    const log = (msg) => {
      document.getElementById('log').textContent += msg + '\n';
    };

    document.getElementById("connect").onclick = async () => {
      try {
        device = await navigator.usb.requestDevice({
          filters: [{ vendorId: 0x2341 }] // Arduino„ÅÆVID
        });
        await device.open();
        await device.selectConfiguration(1);
        await device.claimInterface(2); // interfaceNumber„ÅØ2ÔºàË¶ÅË™øÊï¥Ôºâ
        log("‚úÖ Êé•Á∂öÊàêÂäü");
        document.getElementById("ledOn").disabled = false;
        document.getElementById("ledOff").disabled = false;
      } catch (e) {
        log("‚ùå Êé•Á∂öÂ§±Êïó: " + e.message);
      }
    };
const readResponse = async () => {
  const result = await device.transferIn(5, 64); // endpoint 5, IN
  const decoder = new TextDecoder();
  log("üü¢ Arduino says: " + decoder.decode(result.data));
};

document.getElementById("ledOn").onclick = async () => {
  await sendCommand("ON");
  await readResponse();
};

document.getElementById("ledOff").onclick = async () => {
  await sendCommand("OFF");
  await readResponse();
};

    const sendCommand = async (cmd) => {
      const encoder = new TextEncoder();
      await device.transferOut(4, encoder.encode(cmd + '\n'));
    };

    document.getElementById("ledOn").onclick = () => sendCommand("ON");
    document.getElementById("ledOff").onclick = () => sendCommand("OFF");
  </script>
</body>
</html>
